<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI Crop Recommendation - Full</title>
  <script src="https://cdn.tailwindcss.com">
    document.querySelectorAll('button').forEach(b => {
  b.addEventListener('mousedown', () => b.classList.add('active'));
  b.addEventListener('mouseup', () => b.classList.remove('active'));
  b.addEventListener('mouseleave', () => b.classList.remove('active'));
});
  </script>
  <style>
    /* small local styles alongside Tailwind */
    body { font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
    .card { background: rgba(255,255,255,0.92); border-radius: 12px; box-shadow: 0 6px 20px rgba(0,0,0,0.08); padding: 20px; }
    body.dark .card { background: rgba(20,20,20,0.86); color: #eee; }
    header { backdrop-filter: blur(6px); }
    .nav-link.active { box-shadow: inset 0 -3px 0 0 #fff; } /* simple active underline effect (white on green header) */
    .profile-pic { width: 100px; height: 100px; object-fit: cover; border-radius: 9999px; border: 3px solid #fff; }
    .small-btn { padding: .35rem .6rem; border-radius: .45rem; }
    .hero { background: linear-gradient(90deg,#27ae60,#2ecc71); color: white; border-radius: 12px; padding: 48px 24px; }
    @media (max-width:640px){ .hero h1{font-size:1.5rem;} }
    /* paste inside your <style> tag near the top of index.html */
.btn-anim {
  transition: transform .18s ease, box-shadow .18s ease;
  will-change: transform;
}
.card-anim {
  transition: transform .22s cubic-bezier(.2,.8,.2,1), box-shadow .22s ease;
  will-change: transform;
}
.img-zoom {
  transition: transform .22s ease, box-shadow .22s ease;
}
button.active { transform: scale(.97) !important; transition: transform .08s ease; }

  </style>
  <!-- AOS Library -->
<link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    AOS.init({
      duration: 800,   // Animation speed (ms)
      once: true       // Animation runs only once
    });
  });
</script>
</head>
<body class="bg-gray-100 text-gray-800">

  <!-- Header / Nav -->
  <header class="w-full sticky top-0 z-40 p-4 bg-green-600 text-white flex items-center justify-between">
    <div class="flex items-center gap-4">
      <div class="text-xl font-bold">ðŸŒ¾ AI Crop Recommender</div>
    </div>

    <nav class="flex items-center gap-2 text-sm">
      <a id="navHome" class="nav-link px-3 py-1 hover:opacity-90 cursor-pointer transform transition duration-150 hover:-translate-y-1 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-white"
        onclick="showPage('home')">Home</a>
      <a id="navLogin" class="nav-link px-3 py-1 hover:opacity-90 cursor-pointer" onclick="showPage('login')">Login / Signup</a>

      <!-- protected nav items: become visible only after login -->
      <a id="navDashboard" class="nav-link px-3 py-1 hover:opacity-90 cursor-pointer hidden" onclick="showPage('dashboard')">Dashboard</a>
      <a id="navAbout" class="nav-link px-3 py-1 hover:opacity-90 cursor-pointer hidden" onclick="showPage('about')">About</a>
      <a id="navContact" class="nav-link px-3 py-1 hover:opacity-90 cursor-pointer hidden" onclick="showPage('contact')">Contact</a>
      <a id="navProfile" class="nav-link px-3 py-1 hover:opacity-90 cursor-pointer hidden" onclick="showPage('profile')">Profile</a>

      <button id="navLogout" class="ml-2 hidden bg-white text-green-600 px-3 py-1 rounded small-btn" onclick="logout()">Logout</button>
    </nav>
  </header>

  <main class="max-w-6xl mx-auto p-6">

    <!-- HOME / Landing -->
<section id="homePage" class="card" data-aos="fade-up">
  <!-- Hero Section -->
  <div class="relative bg-green-100 py-20 text-center">
    <div class="container mx-auto px-6">
      <h2 class="text-4xl md:text-5xl font-bold text-green-800 mb-6">
        Smarter Farming with AI ðŸŒ¾
      </h2>
      <p class="text-lg text-gray-700 max-w-2xl mx-auto mb-8">
        Get intelligent crop recommendations, fertilizer suggestions, and yield insights powered by artificial intelligence.
      </p>
      <a href="#"
         class="bg-green-700 text-white px-6 py-3 rounded-lg text-lg font-semibold hover:bg-green-800 transition">
        Explore Features
      </a>
    </div>
  </div>

  <!-- Features Section (now part of homePage only) -->
  <div class="py-16 bg-white">
    <div class="container mx-auto px-6 text-center">
      <h2 class="text-3xl font-bold text-green-700 mb-12" data-aos="fade-up">
        Our Features
      </h2>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">

        <!-- Card 1 -->
        <div class="p-6 bg-white rounded-xl shadow-sm text-center transform transition duration-300 hover:scale-105 hover:-translate-y-1 hover:shadow-2xl"
             data-aos="zoom-in" data-aos-delay="100">
          <i class="fas fa-seedling text-green-600 text-5xl mb-4"></i>
          <h3 class="text-xl font-semibold mb-2">Crop Recommendation</h3>
          <p class="text-gray-600">
            Get AI-powered crop suggestions based on soil nutrients, rainfall, and temperature.
          </p>
        </div>

        <!-- Card 2 -->
        <div class="p-6 bg-white rounded-xl shadow-sm text-center transform transition duration-300 hover:scale-105 hover:-translate-y-1 hover:shadow-2xl"
             data-aos="zoom-in" data-aos-delay="200">
          <i class="fas fa-flask text-green-600 text-5xl mb-4"></i>
          <h3 class="text-xl font-semibold mb-2">Fertilizer Advice</h3>
          <p class="text-gray-600">
            Find the best fertilizer mix based on nutrient levels and crop requirements.
          </p>
        </div>

        <!-- Card 3 -->
        <div class="p-6 bg-white rounded-xl shadow-sm text-center transform transition duration-300 hover:scale-105 hover:-translate-y-1 hover:shadow-2xl"
             data-aos="zoom-in" data-aos-delay="300">
          <i class="fas fa-chart-line text-green-600 text-5xl mb-4"></i>
          <h3 class="text-xl font-semibold mb-2">Yield Insights</h3>
          <p class="text-gray-600">
            Monitor your farm performance with data-driven insights for better productivity.
          </p>
        </div>

      </div>
    </div>
  </div>
</section>

    <!-- LOGIN / SIGNUP PAGE (used for both) -->
    <section id="loginPage" class="card mx-auto max-w-xl hidden">
      <h2 class="text-2xl font-bold text-green-700 mb-4">Create Account or Login</h2>
      <form id="authForm" class="grid gap-3">
        <label class="text-sm">Full name</label>
        <input id="fullName" class="p-2 border rounded" placeholder="Asha Kumar" required />

        <label class="text-sm">Email</label>
        <input id="email" type="email" class="p-2 border rounded" placeholder="asha@example.com" required />

        <label class="text-sm">Phone</label>
        <input id="phone" class="p-2 border rounded" placeholder="+91 98765 43210" />

        <label class="text-sm">Location</label>
        <input id="location" class="p-2 border rounded" placeholder="District, State" />

        <label class="text-sm">Password</label>
        <input id="password" type="password" class="p-2 border rounded" placeholder="Choose a password" required />

        <div class="flex gap-3">
          <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded">Submit</button>
          <button type="button" class="bg-gray-200 px-4 py-2 rounded" onclick="showPage('home')">Cancel</button>
        </div>
        <p class="text-xs text-gray-600 mt-2">This demo stores profile in the browser only (localStorage). For real auth, integrate a backend.</p>
      </form>
    </section>

   <!-- ABOUT (protected) -->
<section id="aboutPage" class="card hidden" data-aos="fade-up">
  <h2 class="text-2xl font-bold mb-3 text-green-700">About the Project</h2>

  <p class="mb-4 text-gray-700">
    ðŸŒ± The <strong>AI Crop Recommender</strong> is an intelligent system built to help farmers,
    students, and researchers make data-driven agricultural decisions. Using inputs like soil nutrients,
    rainfall, pH, temperature, and previous crop history, the system suggests the best crops to grow
    and provides smart fertilizer guidance.
  </p>

  <h3 class="text-xl font-semibold mb-2 text-green-600">ðŸš€ Key Features</h3>
  <ul class="list-disc ml-6 mb-4 text-gray-700 space-y-1">
    <li>Crop recommendation based on soil, water, and climate conditions</li>
    <li>Fertilizer suggestions for balanced nutrient management</li>
    <li>Farmer-friendly interface with easy forms and results</li>
    <li>Offline demo mode for testing without backend</li>
    <li>Profile creation and local storage for personalization</li>
  </ul>

  <h3 class="text-xl font-semibold mb-2 text-green-600">ðŸ“Š Why This Matters</h3>
  <p class="mb-4 text-gray-700">
    Agriculture is the backbone of food security. Wrong crop choices or poor soil management can reduce
    yield and income. By combining <strong>machine learning</strong>, <strong>climate insights</strong>,
    and <strong>soil data</strong>, this project helps farmers achieve better productivity while using
    fewer resources.
  </p>

  <h3 class="text-xl font-semibold mb-2 text-green-600">ðŸ”® Future Improvements</h3>
  <ul class="list-disc ml-6 mb-4 text-gray-700 space-y-1">
    <li>Integration with live weather APIs for real-time recommendations</li>
    <li>Multi-language support for wider accessibility</li>
    <li>Cloud deployment for access on mobile devices</li>
    <li>Integration with satellite & IoT sensors</li>
  </ul>

  <p class="mt-4 text-sm text-gray-600 italic">
    This is currently a <strong>demo project</strong> designed for learning and student research purposes.
    With further development, it has the potential to be deployed as a full-scale farmer support tool.
  </p>
</section>

    <!-- CONTACT (protected) -->
    <section id="contactPage" class="card hidden">
      <h2 class="text-2xl font-bold mb-3">Contact Us</h2>
      <form id="contactForm" class="grid gap-3 max-w-lg">
        <input id="contactName" placeholder="Your name" class="p-2 border rounded" required />
        <input id="contactEmail" type="email" placeholder="you@example.com" class="p-2 border rounded" required />
        <textarea id="contactMessage" rows="4" placeholder="Message" class="p-2 border rounded" required></textarea>
        <div class="flex gap-3">
          <button class="bg-green-600 text-white px-4 py-2 rounded">Send</button>
          <button type="button" class="bg-gray-200 px-4 py-2 rounded" onclick="showPage('home')">Cancel</button>
        </div>
        <div id="contactSaved" class="text-green-600 mt-2"></div>
      </form>
    </section>

    <!-- PROFILE (protected) -->
    <section id="profilePage" class="card hidden max-w-lg">
      <div class="flex items-center gap-4">
        <img id="profilePic" src="https://via.placeholder.com/100" alt="Profile" class="profile-pic shadow img-zoom transform transition duration-200 hover:scale-105" />
        <div>
          <div id="profileDisplayName" class="font-bold text-lg"></div>
          <div id="profileDisplayEmail" class="text-sm text-gray-600"></div>
        </div>
      </div>

      <div class="mt-4">
        <label class="block text-sm mb-1">Upload profile picture</label>
        <input id="profilePicInput" type="file" accept="image/*" />
      </div>

      <form id="profileForm" class="grid gap-3 mt-4">
        <label>Name</label>
        <input id="profileName" class="p-2 border rounded" />

        <label>Phone</label>
        <input id="profilePhone" class="p-2 border rounded" />

        <label>Location</label>
        <input id="profileLocation" class="p-2 border rounded" />

        <div class="flex gap-3">
          <button class="bg-green-600 text-white px-4 py-2 rounded">Save Profile</button>
          <button type="button" class="bg-gray-200 px-4 py-2 rounded" onclick="showPage('dashboard')">Back</button>
        </div>
        <div id="profileSaved" class="text-green-600"></div>
      </form>
    </section>

    <!-- DASHBOARD (protected) -->
    <section id="dashboardPage" class="hidden">
      <div class="grid md:grid-cols-2 gap-6">
        <!-- Crop Recommendation -->
        <div class="card card-anim transform transition duration-200 hover:-translate-y-1 hover:scale-102 hover:shadow-2xl">
          <h3 class="text-xl font-bold text-green-700 mb-3">Crop Recommendation</h3>
          <form id="cropForm" class="grid gap-3">
            <div class="grid grid-cols-2 gap-2">
              <div><label class="text-sm">Nitrogen (N)</label><input id="nitrogen" type="number" class="p-2 border rounded focus:ring-2 focus:ring-green-200 focus:border-green-400 transition" /></div>
              <div><label class="text-sm">Phosphorus (P)</label><input id="phosphorus" type="number" class="p-2 border rounded" /></div>
              <div><label class="text-sm">Potassium (K)</label><input id="potassium" type="number" class="p-2 border rounded" /></div>
              <div><label class="text-sm">Soil pH</label><input id="ph" type="number" step="0.1" class="p-2 border rounded" /></div>
            </div>

            <div class="grid grid-cols-2 gap-2">
              <div><label class="text-sm">Moisture (%)</label><input id="moisture" type="number" class="p-2 border rounded" /></div>
              <div><label class="text-sm">Avg Temp (Â°C)</label><input id="avg_temp" type="number" class="p-2 border rounded" /></div>
              <div><label class="text-sm">Rainfall (mm)</label><input id="rainfall" type="number" class="p-2 border rounded" /></div>
              <div>
                <label class="text-sm">Water Availability</label>
                <select id="water_available" class="p-2 border rounded">
                  <option value="low">Low</option>
                  <option value="medium">Medium</option>
                  <option value="high">High</option>
                </select>
              </div>
            </div>

            <label class="text-sm">Previous Crop</label>
            <input id="previous_crop" class="p-2 border rounded" />

            <div class="flex gap-3 mt-2">
              <button class="bg-green-600 text-white px-4 py-2 rounded transform transition duration-150 btn-anim hover:shadow-lg active:scale-95 focus:outline-none focus:ring-2 focus:ring-green-300">Get Recommendations</button>
              <button type="reset" class="bg-gray-200 px-4 py-2 rounded">Reset</button>
            </div>
          </form>
        </div>

        <!-- Fertilizer Suggestion -->
        <div class="card card-anim transform transition duration-200 hover:-translate-y-1 hover:scale-102 hover:shadow-2xl">
          <h3 class="text-xl font-bold text-green-700 mb-3">Fertilizer Suggestion</h3>
          <form id="fertilizerForm" class="grid gap-3">
            <div class="grid grid-cols-2 gap-2">
              <div><label class="text-sm">Nitrogen (N)</label><input id="fert_nitrogen" type="number" class="p-2 border rounded" /></div>
              <div><label class="text-sm">Phosphorus (P)</label><input id="fert_phosphorus" type="number" class="p-2 border rounded" /></div>
              <div><label class="text-sm">Potassium (K)</label><input id="fert_potassium" type="number" class="p-2 border rounded" /></div>
              <div><label class="text-sm">Target Crop</label><input id="target_crop" class="p-2 border rounded" /></div>
            </div>

            <div class="flex gap-3 mt-2">
              <button class="bg-green-600 text-white px-4 py-2 rounded">Get Fertilizer Suggestions</button>
              <button type="reset" class="bg-gray-200 px-4 py-2 rounded">Reset</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Results sections -->
      <div class="grid md:grid-cols-2 gap-6 mt-6">
        <div class="card">
          <h4 class="font-bold text-green-700 mb-3">Recommended Crops</h4>
          <div id="cropResult" class="grid gap-3"></div>
        </div>
        <div class="card card-anim transform transition duration-200 hover:-translate-y-1 hover:scale-102 hover:shadow-2xl">
          <h4 class="font-bold text-green-700 mb-3">Fertilizer Suggestions</h4>
          <div id="fertilizerResult"></div>
        </div>
      </div>
    </section>

  </main>

  <script>
    /* ---------- Configuration ---------- */
    const backendUrl = "http://127.0.0.1:8000"; // change if needed

    /* ---------- Utility / Access Control ---------- */
    function updateNavVisibility() {
      const loggedIn = !!localStorage.getItem('user');
      document.getElementById('navLogin').classList.toggle('hidden', loggedIn);
      document.getElementById('navDashboard').classList.toggle('hidden', !loggedIn);
      document.getElementById('navAbout').classList.toggle('hidden', !loggedIn);
      document.getElementById('navContact').classList.toggle('hidden', !loggedIn);
      document.getElementById('navProfile').classList.toggle('hidden', !loggedIn);
      document.getElementById('navLogout').classList.toggle('hidden', !loggedIn);
    }

    function setActiveNav(page) {
      const map = { home:'navHome', login:'navLogin', dashboard:'navDashboard', about:'navAbout', contact:'navContact', profile:'navProfile' };
      Object.values(map).forEach(id => id && document.getElementById(id)?.classList.remove('bg-green-700','rounded'));
      if(map[page]) document.getElementById(map[page])?.classList.add('bg-green-700','rounded');
    }

    function showPage(page) {
      // page: 'home','login','about','contact','dashboard','profile'
      const allowedBeforeLogin = ['home','login'];
      const loggedIn = !!localStorage.getItem('user');

      // If not logged in, allow only home or login
      if (!loggedIn && !allowedBeforeLogin.includes(page)) {
        // redirect to Home (as requested)
        showPage('home');
        return;
      }

      // Hide all page sections
      ['home','login','about','contact','dashboard','profile'].forEach(p => {
        const el = document.getElementById(p + 'Page'); // but our ids are e.g. homePage, loginPage, aboutPage...
        // we used ids: homePage, loginPage, aboutPage, contactPage, profilePage, dashboardPage
      });

      // Instead of that, map page to exact element ids:
      const idMap = {
        home: 'homePage',
        login: 'loginPage',
        about: 'aboutPage',
        contact: 'contactPage',
        dashboard: 'dashboardPage',
        profile: 'profilePage'
      };

      // hide all
      Object.values(idMap).forEach(id => {
        const el = document.getElementById(id);
        if (el) el.classList.add('hidden');
      });

      // show requested
      const showId = idMap[page];
      if (showId) {
        const el = document.getElementById(showId);
        if (el) el.classList.remove('hidden');
      }

      // update nav and visibility
      updateNavVisibility();
      setActiveNav(page);

      // If showing profile, fill profile fields
      if (page === 'profile') {
        const userEmail = localStorage.getItem('user') || '';
        document.getElementById('profileDisplayEmail').innerText = userEmail;
        document.getElementById('profileDisplayName').innerText = localStorage.getItem('profileName') || '';
        document.getElementById('profileEmail').value = userEmail;
        document.getElementById('profileName').value = localStorage.getItem('profileName') || '';
        document.getElementById('profilePhone').value = localStorage.getItem('profilePhone') || '';
        document.getElementById('profileLocation').value = localStorage.getItem('profileLocation') || '';
        const pic = localStorage.getItem('profilePic');
        if (pic) document.getElementById('profilePic').src = pic;
      }
    }

    /* Shortcut to show a protected page (redirect to home if not logged) */
    function protectedShow(page) {
      if (!localStorage.getItem('user')) {
        alert('Please login first to access this page.');
        showPage('home');
        return;
      }
      showPage(page);
    }

    function logout() {
      // Do not delete stored profile pic/profileName if you prefer; here we keep it but remove "user" to sign out.
      localStorage.removeItem('user');
      updateNavVisibility();
      showPage('home');
    }

    /* ---------- Auth (Signup/Login in same form) ---------- */
    document.getElementById('authForm').addEventListener('submit', function (ev) {
      ev.preventDefault();
      const name = document.getElementById('fullName').value.trim();
      const email = document.getElementById('email').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const location = document.getElementById('location').value.trim();
      const pwd = document.getElementById('password').value;

      if (!email || !pwd) {
        alert('Please enter email and password.');
        return;
      }

      // For demo: store email as logged in user key; store profile fields separately
      localStorage.setItem('user', email);
      localStorage.setItem('profileName', name);
      localStorage.setItem('profilePhone', phone);
      localStorage.setItem('profileLocation', location);

      updateNavVisibility();
      // After login go directly to dashboard (per request)
      showPage('dashboard');
    });

    /* ---------- Profile picture upload ---------- */
    document.getElementById('profilePicInput').addEventListener('change', function (ev) {
      const f = ev.target.files && ev.target.files[0];
      if (!f) return;
      const reader = new FileReader();
      reader.onload = function (e) {
        const dataUrl = e.target.result;
        localStorage.setItem('profilePic', dataUrl);
        document.getElementById('profilePic').src = dataUrl;
      };
      reader.readAsDataURL(f);
    });

    /* ---------- Profile form save ---------- */
    document.getElementById('profileForm').addEventListener('submit', function (ev) {
      ev.preventDefault();
      localStorage.setItem('profileName', document.getElementById('profileName').value.trim());
      localStorage.setItem('profilePhone', document.getElementById('profilePhone').value.trim());
      localStorage.setItem('profileLocation', document.getElementById('profileLocation').value.trim());
      document.getElementById('profileSaved').innerText = 'âœ… Profile saved locally';
      // update header display
      document.getElementById('profileDisplayName').innerText = localStorage.getItem('profileName') || '';
    });

    /* ---------- Contact form ---------- */
    document.getElementById('contactForm').addEventListener('submit', function (ev) {
      ev.preventDefault();
      const obj = {
        name: document.getElementById('contactName').value.trim(),
        email: document.getElementById('contactEmail').value.trim(),
        message: document.getElementById('contactMessage').value.trim(),
        ts: new Date().toISOString()
      };
      // store an array of messages in localStorage (demo)
      const arr = JSON.parse(localStorage.getItem('contactMessages') || '[]');
      arr.push(obj);
      localStorage.setItem('contactMessages', JSON.stringify(arr));
      document.getElementById('contactSaved').innerText = 'âœ… Message saved (demo). Thank you!';
      document.getElementById('contactForm').reset();
    });

    /* ---------- Small fallback logic for demo when backend missing ---------- */
    function demoCropRecommendations(data) {
      // Simple rules: produce 3 example crops with a "score" based on matching conditions
      const list = [
        { crop: 'Rice', ideal: { ph: [5.5,7], water: 'high' } },
        { crop: 'Wheat', ideal: { ph: [6,7.5], water: 'medium' } },
        { crop: 'Maize', ideal: { ph: [5.5,7.5], water: 'medium' } },
        { crop: 'Sugarcane', ideal: { ph: [6,7.5], water: 'high' } },
        { crop: 'Millets', ideal: { ph: [5,8], water: 'low' } }
      ];
      const out = list.map(item => {
        let score = 50;
        if (data.ph >= item.ideal.ph[0] && data.ph <= item.ideal.ph[1]) score += 20;
        if (data.water_available === item.ideal.water) score += 20;
        const nutrient = (data.nitrogen + data.phosphorus + data.potassium) / 3;
        if (nutrient >= 50) score += 10;
        return { crop: item.crop, score: Math.min(100, Math.round(score)) };
      });
      // sort best first
      out.sort((a,b) => b.score - a.score);
      return out.slice(0,3);
    }

    function demoFertilizerSuggestion(data) {
      // very simple suggestions
      const suggestions = {};
      if (data.nitrogen < 50) suggestions.N = 'Add Urea (46% N) as per requirement';
      else suggestions.N = 'Nitrogen is sufficient';

      if (data.phosphorus < 30) suggestions.P = 'Add DAP (46% P2O5) or Single Super Phosphate';
      else suggestions.P = 'Phosphorus is sufficient';

      if (data.potassium < 40) suggestions.K = 'Add MOP (60% K2O)';
      else suggestions.K = 'Potassium is sufficient';

      return suggestions;
    }

    /* ---------- Crop form submit ---------- */
    document.getElementById('cropForm').addEventListener('submit', async function (ev) {
      ev.preventDefault();
      const payload = {
        nitrogen: Number(document.getElementById('nitrogen').value || 0),
        phosphorus: Number(document.getElementById('phosphorus').value || 0),
        potassium: Number(document.getElementById('potassium').value || 0),
        ph: Number(document.getElementById('ph').value || 0),
        moisture: Number(document.getElementById('moisture').value || 0),
        avg_temp: Number(document.getElementById('avg_temp').value || 0),
        rainfall: Number(document.getElementById('rainfall').value || 0),
        water_available: document.getElementById('water_available').value || 'medium',
        previous_crop: document.getElementById('previous_crop').value || ''
      };

      // try calling backend; if fails, show demo results
      try {
        const resp = await fetch(`${backendUrl}/recommend`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        if (!resp.ok) throw new Error('Backend returned ' + resp.status);
        const json = await resp.json();
        renderCropResults(json.recommendations || demoCropRecommendations(payload));
      } catch (err) {
        console.warn('Backend fetch failed, using demo recommendations:', err);
        const demo = demoCropRecommendations(payload);
        renderCropResults(demo);
      }
    });

    function renderCropResults(list) {
      const wrap = document.getElementById('cropResult');
      wrap.innerHTML = '';
      if (!Array.isArray(list) || list.length === 0) {
        wrap.innerHTML = '<div class="text-sm text-gray-600">No recommendations found.</div>';
        return;
      }
      list.forEach(item => {
        const div = document.createElement('div');
        div.className = 'p-3 rounded border';
        div.innerHTML = `<div class="font-semibold text-green-700">${escapeHtml(item.crop)}</div>
                         <div class="text-sm text-gray-600">Suitability: <strong>${escapeHtml(String(item.score))}%</strong></div>`;
        wrap.appendChild(div);
      });
    }

    /* ---------- Fertilizer form submit ---------- */
    document.getElementById('fertilizerForm').addEventListener('submit', async function (ev) {
      ev.preventDefault();
      const payload = {
        nitrogen: Number(document.getElementById('fert_nitrogen').value || 0),
        phosphorus: Number(document.getElementById('fert_phosphorus').value || 0),
        potassium: Number(document.getElementById('fert_potassium').value || 0),
        target_crop: document.getElementById('target_crop').value || ''
      };

      try {
        const resp = await fetch(`${backendUrl}/fertilizer`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        if (!resp.ok) throw new Error('Backend returned ' + resp.status);
        const json = await resp.json();
        renderFertilizerResults(json.suggestions || demoFertilizerSuggestion(payload));
      } catch (err) {
        console.warn('Backend fertilizer fetch failed, using demo:', err);
        const demo = demoFertilizerSuggestion(payload);
        renderFertilizerResults(demo);
      }
    });

    function renderFertilizerResults(obj) {
      const wrap = document.getElementById('fertilizerResult');
      wrap.innerHTML = '';
      if (!obj || Object.keys(obj).length === 0) {
        wrap.innerHTML = '<div class="text-sm text-gray-600">No suggestions found.</div>';
        return;
      }
      const ul = document.createElement('ul');
      ul.className = 'list-disc pl-5';
      for (const [k,v] of Object.entries(obj)) {
        const li = document.createElement('li');
        li.className = 'mb-1';
        li.innerHTML = `<strong>${escapeHtml(k)}:</strong> ${escapeHtml(String(v))}`;
        ul.appendChild(li);
      }
      wrap.appendChild(ul);
    }

    /* ---------- small helper ---------- */
    function escapeHtml(s) {
      return (s+'').replace(/[&<>"']/g, function(m){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]; });
    }

    /* ---------- On load initializations ---------- */
    window.addEventListener('load', function () {
      // map our section ids used in code: these must exist
      const expected = ['homePage','loginPage','aboutPage','contactPage','profilePage','dashboardPage'];
      // verify elements exist
      for (const id of expected) {
        if (!document.getElementById(id)) {
          console.warn('Missing element id:', id);
        }
      }

      // restore profile picture if any
      const pic = localStorage.getItem('profilePic');
      if (pic) document.getElementById('profilePic').src = pic;

      updateNavVisibility();

      // if logged in -> go to dashboard, else show home
      if (localStorage.getItem('user')) {
        showPage('dashboard');
      } else {
        showPage('home');
      }
    });

    /* allow quick testing by clearing only non-profile keys if you want in console:
       localStorage.removeItem('user'); showPage('home');  */

  </script>
</body>
</html>
